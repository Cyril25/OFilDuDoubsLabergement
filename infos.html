<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!-- Balises Open Graph -->
        <meta property="og:title" content="O'Fil du Doubs" />
        <meta property="og:description" content="Bienvenue à O'Fil du Doubs, votre logement touristique à Labergement-Sainte-Marie." />
        <meta property="og:image" content="https://cyril25.github.io/OFilDuDoubsLabergement/images/banniere/vue-balcon-2.jpg" />
        <meta property="og:url" content="https://cyril25.github.io/OFilDuDoubsLabergement/test_menu_fixe/" />
        <meta property="og:type" content="website" />

        <!-- Balise pour Twitter (optionnelle mais recommandée) -->
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:image" content="https://cyril25.github.io/OFilDuDoubsLabergement/images/banniere/vue-balcon-2.jpg">

    <title>O'Fil du Doubs - Location de charme</title>
    <link rel="stylesheet" href="styles.css">
    <script src="scripts/menu-translations.js"></script>
    <script src="scripts/infos-translations.js"></script> <!-- Attention à modifier pour chaque page -->
    <script src="scripts/applyTranslations.js"></script>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- FullCalendar CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.2.0/fullcalendar.min.css" rel="stylesheet">

    <!-- Moment.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>

    <!-- FullCalendar JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.2.0/fullcalendar.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.2.0/locale/fr.js"></script>
</head>
<body>
    <!-- Conteneur pour le menu -->
    <div id="menu-container"></div>
    <header class="header2">
        <h1 id="title">Informations pratiques</h1>
    </header>
    <main>
        <section>
            <p id="description">Situé à Labergement-Sainte-Marie, notre logement vous offre un cadre idéal pour un séjour relaxant au cœur du Jura.</p>
            <img src="images/vue-balcon.jpg" alt="Vue depuis le balcon" class="view-image">
        </section>
        <section>
            <h2 id="welcome">Bienvenue chez Alisson et Cyril - O'Fil du Doubs</h2>
            <p id="description">Situé à Labergement-Sainte-Marie, notre logement vous offre un cadre idéal pour un séjour relaxant au cœur du Jura.</p>
            <img src="images/vue-balcon.jpg" alt="Vue depuis le balcon" class="view-image">
        </section>
        <section>
            <h2 id="welcome">Bienvenue chez Alisson et Cyril - O'Fil du Doubs</h2>
            <p id="description">Situé à Labergement-Sainte-Marie, notre logement vous offre un cadre idéal pour un séjour relaxant au cœur du Jura.</p>
            <img src="images/vue-balcon.jpg" alt="Vue depuis le balcon" class="view-image">
        </section>
        <section>
            <h2>Disponibilités</h2>
            <div id="calendar"></div> <!-- C'est ici que les événements seront affichés -->
        </section>
    </main>
    <footer>
        <p>© O'Fil du Doubs - Tous droits réservés</p>
    </footer>

    <script>
        // Fonction pour récupérer le fichier iCalendar
        fetch('https://ical-proxy-node.onrender.com/ical')
            .then(response => response.text())
            .then(data => {
                const events = parseICS(data);
                initializeCalendar(events);
            })
            .catch(error => console.error('Erreur lors de la récupération du fichier iCal:', error));

        // Fonction pour parser le fichier iCalendar (.ics)
        function parseICS(icsData) {
            const events = [];
            const eventPattern = /BEGIN:VEVENT[\s\S]+?END:VEVENT/g;
            const eventsRaw = icsData.match(eventPattern);

            if (eventsRaw) {
                eventsRaw.forEach(event => {
                    const eventDetails = {};
                    const summaryPattern = /SUMMARY:(.*)/;
                    const datePatternStart = /DTSTART;VALUE=DATE:(\d{8})/;
                    const datePatternEnd = /DTEND;VALUE=DATE:(\d{8})/;
                    const descriptionPattern = /DESCRIPTION:(.*)/;

                    const summary = event.match(summaryPattern);
                    const startDate = event.match(datePatternStart);
                    const endDate = event.match(datePatternEnd);
                    const description = event.match(descriptionPattern);

                    if (summary && startDate && endDate) {
                        eventDetails.title = 'Indisponible'; // On force le titre à "Indisponible"
                        eventDetails.start = formatDate(startDate[1]);
                        eventDetails.end = formatDate(endDate[1]);
                        eventDetails.description = description ? description[1] : 'Pas de description';
                        events.push(eventDetails);
                    }
                });
            }
            return events;
        }

        // Fonction pour formater les dates au format ISO (YYYY-MM-DD)
        function formatDate(dateString) {
            const year = dateString.substring(0, 4);
            const month = dateString.substring(4, 6);
            const day = dateString.substring(6, 8);
            return `${year}-${month}-${day}`;
        }

        // Fonction pour initialiser le calendrier avec FullCalendar
        function initializeCalendar(events) {
            $('#calendar').fullCalendar({
                locale: 'fr',
                height: 'auto', // Ensures the calendar adjusts to show the full month
                events: events.map(event => ({
                    title: event.title,
                    start: event.start,
                    end: event.end,
                    description: event.description
                }))
            });
        }
    </script>
</body>
</html>